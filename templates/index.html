<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Letras & Fotos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <h1>Catálogo Musical de Letras e Imágenes</h1>
    <div class="header-actions">
        <a href="{{ url_for('agregar_cancion') }}" class="button">Agregar nueva Canción</a>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Buscar canción por título..." onkeyup="buscarCanciones()">
        </div>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul class="flashes">
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    {% if canciones %}
        <div id="song-list-container">
            <ul class="song-list" id="initial-song-list">
                {% for cancion in canciones %}
    <li class="song-item">
        <div class="song-info">
            <strong>{{ cancion.titulo }}</strong>
        </div>
        
        <div class="song-media-actions"> <div class="song-image">
                {% if cancion.ruta_foto %}
                    <a href="{{ url_for('static', filename=cancion.ruta_foto) }}" download="{{ cancion.titulo | replace(' ', '_') }}.jpg">
                        <img src="{{ url_for('static', filename=cancion.ruta_foto) }}" alt="Foto de {{ cancion.titulo }}" class="foto-cancion">
                    </a>
                {% else %}
                    <span class="no-photo">No hay foto disponible</span>
                {% endif %}
            </div>

            {% if cancion.letra %}
                <button class="copy-lyrics-button" data-lyrics-id="lyrics-preview-{{ cancion.id }}">Copiar Letra</button>
            {% endif %}
        </div> {% if cancion.letra %}
            <div class="song-lyrics-preview" id="lyrics-preview-{{ cancion.id }}">
                <p>{{ cancion.letra[:300] }}
                    {% if cancion.letra | length > 300 %}
                        ... <span class="read-more" data-target="full-lyrics-{{ cancion.id }}">Leer más</span>
                    {% endif %}
                </p>
                <div id="full-lyrics-{{ cancion.id }}" class="full-lyrics" style="display: none;">
                    <p>{{ cancion.letra }} <span class="read-less" data-target="lyrics-preview-{{ cancion.id }}">Leer menos</span></p>
                </div>
            </div>
        {% endif %}

        <div class="song-actions">
            </div>
        
        </li>
{% endfor %}
            </ul>
        </div>
        <div class="pagination">
            {% if page > 1 %}
            <a href="{{ url_for('index', page=page - 1) }}" class="page-link">&laquo; Anterior</a>
            {% else %}
            <span class="page-link disabled">&laquo; Anterior</span>
            {% endif %}

            {% for p in range(1, total_paginas + 1) %}
            <a href="{{ url_for('index', page=p) }}" class="page-link {% if p == page %}active{% endif %}">{{ p }}</a>
            {% endfor %}

            {% if page < total_paginas %}
            <a href="{{ url_for('index', page=page + 1) }}" class="page-link">Siguiente &raquo;</a>
            {% else %}
            <span class="page-link disabled">Siguiente &raquo;</span>
            {% endif %}
        </div>
    {% else %}
        <p>No hay canciones disponibles. ¡Agrega una!</p>
    {% endif %}

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>